!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.TinaRouter=e()}(this,function(){"use strict";function t(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function e(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}}function r(t,r,o,a){return r=r||"&",o=o||"=",null===t&&(t=void 0),"object"==typeof t?n(w(t),function(a){var s=encodeURIComponent(e(a))+o;return b(t[a])?n(t[a],function(t){return s+encodeURIComponent(e(t))}).join(r):s+encodeURIComponent(e(t[a]))}).join(r):a?encodeURIComponent(e(a))+o+encodeURIComponent(e(t)):""}function n(t,e){if(t.map)return t.map(e);for(var r=[],n=0;n<t.length;n++)r.push(e(t[n],n));return r}function o(e,r,n,o){r=r||"&",n=n||"=";var a={};if("string"!=typeof e||0===e.length)return a;var s=/\+/g;e=e.split(r);var h=1e3;o&&"number"==typeof o.maxKeys&&(h=o.maxKeys);var i=e.length;h>0&&i>h&&(i=h);for(var u=0;u<i;++u){var c,l,f,p,m=e[u].replace(s,"%20"),v=m.indexOf(n);v>=0?(c=m.substr(0,v),l=m.substr(v+1)):(c=m,l=""),f=decodeURIComponent(c),p=decodeURIComponent(l),t(a,f)?b(a[f])?a[f].push(p):a[f]=[a[f],p]:a[f]=p}return a}function a(t,e){return e.mix(t,{beforeLoad:function(t){this.$route={path:"/"+this.route,query:q({},t),fullPath:d(t)?"/"+this.route:"/"+this.route+"?"+x.stringify(t)},this.$log("Route Middleware","Ready")}})}function s(t){throw new RangeError(M[t])}function h(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function i(t,e,r){var n=0;for(t=r?L(t/k):t>>1,t+=L(t/e);t>_*I>>1;n+=R)t=L(t/_);return L(n+(_+1)*t/(t+T))}function u(t){return function(t,e){var r=t.split("@"),n="";return r.length>1&&(n=r[0]+"@",t=r[1]),n+function(t,e){for(var r=t.length,n=[];r--;)n[r]=e(t[r]);return n}((t=t.replace(F,".")).split("."),e).join(".")}(t,function(t){return E.test(t)?"xn--"+function(t){var e,r,n,o,a,u,c,l,f,p,m,v,g,y,d,b=[];for(v=(t=function(t){for(var e,r,n=[],o=0,a=t.length;o<a;)(e=t.charCodeAt(o++))>=55296&&e<=56319&&o<a?56320==(64512&(r=t.charCodeAt(o++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),o--):n.push(e);return n}(t)).length,e=P,r=0,a=$,u=0;u<v;++u)(m=t[u])<128&&b.push(z(m));for(n=o=b.length,o&&b.push(U);n<v;){for(c=C,u=0;u<v;++u)(m=t[u])>=e&&m<c&&(c=m);for(c-e>L((C-r)/(g=n+1))&&s("overflow"),r+=(c-e)*g,e=c,u=0;u<v;++u)if((m=t[u])<e&&++r>C&&s("overflow"),m==e){for(l=r,f=R;p=f<=a?A:f>=a+I?I:f-a,!(l<p);f+=R)d=l-p,y=R-p,b.push(z(h(p+d%y,0))),l=L(d/y);b.push(z(h(l,0))),a=i(r,g,n==o),r=0,++n}++r,++e}return b.join("")}(t):t})}function c(t){return null===t}function l(t){return"string"==typeof t}function f(t){return"object"==typeof t&&null!==t}function p(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function m(t,e,r){if(t&&f(t)&&t instanceof p)return t;var n=new p;return n.parse(t,e,r),n}function v(t){var e=t.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var n=t.protocol||"",o=t.pathname||"",a=t.hash||"",s=!1,h="";t.host?s=e+t.host:t.hostname&&(s=e+(-1===t.hostname.indexOf(":")?t.hostname:"["+this.hostname+"]"),t.port&&(s+=":"+t.port)),t.query&&f(t.query)&&Object.keys(t.query).length&&(h=r(t.query));var i=t.search||h&&"?"+h||"";return n&&":"!==n.substr(-1)&&(n+=":"),t.slashes||(!n||X[n])&&!1!==s?(s="//"+(s||""),o&&"/"!==o.charAt(0)&&(o="/"+o)):s||(s=""),a&&"#"!==a.charAt(0)&&(a="#"+a),i&&"?"!==i.charAt(0)&&(i="?"+i),o=o.replace(/[?#]/g,function(t){return encodeURIComponent(t)}),i=i.replace("#","%23"),n+s+o+i+a}function g(t){var e=t.host,r=K.exec(e);r&&(":"!==(r=r[0])&&(t.port=r.substr(1)),e=e.substr(0,e.length-r.length)),e&&(t.hostname=e)}function y(t){var e=new et(t);return function(t,r){function n(){this.$router=e,this.$router.location=function(){if(this&&this.$route&&this.$route.fullPath)return this.$route.fullPath;if(this&&this.route)return this.route;var t=getCurrentPages();return t&&t[0]&&t[0].route?t[0].route:void 0}.call(this),this.$log("Router Mixin","Ready")}return r.mix(t,{beforeLoad:n,created:n})}}var d=function(t){if(null==t)return!0;if(t.length>0)return!1;if(0===t.length)return!0;for(var e in t)if(hasOwnProperty.call(t,e))return!1;return!0},b=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},w=Object.keys||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.push(r);return e},x={encode:r,stringify:r,decode:o,parse:o},j=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},O=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),q=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},C=2147483647,R=36,A=1,I=26,T=38,k=700,$=72,P=128,U="-",E=/[^\x20-\x7E]/,F=/[\x2E\u3002\uFF0E\uFF61]/g,M={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},_=R-A,L=Math.floor,z=String.fromCharCode;global.setTimeout,global.clearTimeout;global.performance;var B=/^([a-z0-9.+-]+:)/i,K=/:[0-9]*$/,S=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Z=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),H=["'"].concat(Z),D=["%","/","?",";","#"].concat(H),G=["/","?","#"],J=255,N=/^[+a-z0-9A-Z_-]{0,63}$/,Q=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,V={javascript:!0,"javascript:":!0},W={javascript:!0,"javascript:":!0},X={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};p.prototype.parse=function(t,e,r){return function(t,e,r,n){if(!l(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var a=e.indexOf("?"),s=-1!==a&&a<e.indexOf("#")?"?":"#",h=e.split(s);h[0]=h[0].replace(/\\/g,"/");var i=e=h.join(s);if(i=i.trim(),!n&&1===e.split("#").length){var c=S.exec(i);if(c)return t.path=i,t.href=i,t.pathname=c[1],c[2]?(t.search=c[2],t.query=r?o(t.search.substr(1)):t.search.substr(1)):r&&(t.search="",t.query={}),t}var f=B.exec(i);if(f){var p=(f=f[0]).toLowerCase();t.protocol=p,i=i.substr(f.length)}if(n||f||i.match(/^\/\/[^@\/]+@[^@\/]+/)){var m="//"===i.substr(0,2);!m||f&&W[f]||(i=i.substr(2),t.slashes=!0)}var y,d,b,w;if(!W[f]&&(m||f&&!X[f])){var x=-1;for(y=0;y<G.length;y++)-1!==(d=i.indexOf(G[y]))&&(-1===x||d<x)&&(x=d);var j,O;for(-1!==(O=-1===x?i.lastIndexOf("@"):i.lastIndexOf("@",x))&&(j=i.slice(0,O),i=i.slice(O+1),t.auth=decodeURIComponent(j)),x=-1,y=0;y<D.length;y++)-1!==(d=i.indexOf(D[y]))&&(-1===x||d<x)&&(x=d);-1===x&&(x=i.length),t.host=i.slice(0,x),i=i.slice(x),g(t),t.hostname=t.hostname||"";var q="["===t.hostname[0]&&"]"===t.hostname[t.hostname.length-1];if(!q){var C=t.hostname.split(/\./);for(y=0,b=C.length;y<b;y++){var R=C[y];if(R&&!R.match(N)){for(var A="",I=0,T=R.length;I<T;I++)R.charCodeAt(I)>127?A+="x":A+=R[I];if(!A.match(N)){var k=C.slice(0,y),$=C.slice(y+1),P=R.match(Q);P&&(k.push(P[1]),$.unshift(P[2])),$.length&&(i="/"+$.join(".")+i),t.hostname=k.join(".");break}}}}t.hostname.length>J?t.hostname="":t.hostname=t.hostname.toLowerCase(),q||(t.hostname=u(t.hostname)),w=t.port?":"+t.port:"";var U=t.hostname||"";t.host=U+w,t.href+=t.host,q&&(t.hostname=t.hostname.substr(1,t.hostname.length-2),"/"!==i[0]&&(i="/"+i))}if(!V[p])for(y=0,b=H.length;y<b;y++){var E=H[y];if(-1!==i.indexOf(E)){var F=encodeURIComponent(E);F===E&&(F=escape(E)),i=i.split(E).join(F)}}var M=i.indexOf("#");-1!==M&&(t.hash=i.substr(M),i=i.slice(0,M));var _=i.indexOf("?");if(-1!==_?(t.search=i.substr(_),t.query=i.substr(_+1),r&&(t.query=o(t.query)),i=i.slice(0,_)):r&&(t.search="",t.query={}),i&&(t.pathname=i),X[p]&&t.hostname&&!t.pathname&&(t.pathname="/"),t.pathname||t.search){w=t.pathname||"";var L=t.search||"";t.path=w+L}return t.href=v(t),t}(this,t,e,r)},p.prototype.format=function(){return v(this)},p.prototype.resolve=function(t){return this.resolveObject(m(t,!1,!0)).format()},p.prototype.resolveObject=function(t){if(l(t)){var e=new p;e.parse(t,!1,!0),t=e}for(var r=new p,n=Object.keys(this),o=0;o<n.length;o++){var a=n[o];r[a]=this[a]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),h=0;h<s.length;h++){var i=s[h];"protocol"!==i&&(r[i]=t[i])}return X[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}var u;if(t.protocol&&t.protocol!==r.protocol){if(!X[t.protocol]){for(var f=Object.keys(t),m=0;m<f.length;m++){var v=f[m];r[v]=t[v]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||W[t.protocol])r.pathname=t.pathname;else{for(u=(t.pathname||"").split("/");u.length&&!(t.host=u.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==u[0]&&u.unshift(""),u.length<2&&u.unshift(""),r.pathname=u.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var g=r.pathname||"",y=r.search||"";r.path=g+y}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var d=r.pathname&&"/"===r.pathname.charAt(0),b=t.host||t.pathname&&"/"===t.pathname.charAt(0),w=b||d||r.host&&t.pathname,x=w,j=r.pathname&&r.pathname.split("/")||[],O=r.protocol&&!X[r.protocol];u=t.pathname&&t.pathname.split("/")||[],O&&(r.hostname="",r.port=null,r.host&&(""===j[0]?j[0]=r.host:j.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===u[0]?u[0]=t.host:u.unshift(t.host)),t.host=null),w=w&&(""===u[0]||""===j[0]));var q;if(b)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,j=u;else if(u.length)j||(j=[]),j.pop(),j=j.concat(u),r.search=t.search,r.query=t.query;else if(!function(t){return null==t}(t.search))return O&&(r.hostname=r.host=j.shift(),(q=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=q.shift(),r.host=r.hostname=q.shift())),r.search=t.search,r.query=t.query,c(r.pathname)&&c(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!j.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var C=j.slice(-1)[0],R=(r.host||t.host||j.length>1)&&("."===C||".."===C)||""===C,A=0,I=j.length;I>=0;I--)"."===(C=j[I])?j.splice(I,1):".."===C?(j.splice(I,1),A++):A&&(j.splice(I,1),A--);if(!w&&!x)for(;A--;A)j.unshift("..");!w||""===j[0]||j[0]&&"/"===j[0].charAt(0)||j.unshift(""),R&&"/"!==j.join("/").substr(-1)&&j.push("");var T=""===j[0]||j[0]&&"/"===j[0].charAt(0);return O&&(r.hostname=r.host=T?"":j.length?j.shift():"",(q=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=q.shift(),r.host=r.hostname=q.shift())),(w=w||r.host&&j.length)&&!T&&j.unshift(""),j.length?r.pathname=j.join("/"):(r.pathname=null,r.path=null),c(r.pathname)&&c(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},p.prototype.parseHost=function(){return g(this)};var Y={wx:wx},tt={};["switchTab","redirectTo","navigateTo","navigateBack"].forEach(function(t){tt[t]=function(t){return function(e){return new Promise(function(r,n){t(q({},e,{success:function(){r.apply(void 0,arguments)},fail:function(t){return t&&t.errMsg?n(new Error(t.errMsg)):t instanceof Error?n(t):void n(new Error(t))}}))})}}(Y.wx[t])});var et=function(){function t(e){j(this,t),this._tabs=[],this.location="",e&&e.tabs&&(this._tabs=e.tabs)}return O(t,[{key:"isTab",value:function(t){return~this._tabs.indexOf(m(t.slice(1)).pathname)}},{key:"navigate",value:function(t){return this.isTab(t)?tt.switchTab({url:t}):tt.navigateTo({url:t})}},{key:"redirect",value:function(t){return this.isTab(t)?tt.switchTab({url:t}):tt.redirectTo({url:t})}},{key:"back",value:function(){return tt.navigateBack()}}]),t}();return function(t){return[a,y(t)]}});