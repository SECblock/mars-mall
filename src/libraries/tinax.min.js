!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Tinax=e()}(this,function(){"use strict";function t(){if(c.debug){for(var t,e=arguments.length,n=Array(e),s=0;s<e;s++)n[s]=arguments[s];(t=console).log.apply(t,["[Tinax] -"].concat(n))}}var e=function(t,e){return e={exports:{}},t(e,e.exports),e.exports}(function(t){function e(){}function n(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(){this._events=new e,this._eventsCount=0}var r=Object.prototype.hasOwnProperty,o="~";Object.create&&(e.prototype=Object.create(null),(new e).__proto__||(o=!1)),s.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(o?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},s.prototype.listeners=function(t,e){var n=o?o+t:t,s=this._events[n];if(e)return!!s;if(!s)return[];if(s.fn)return[s.fn];for(var r=0,i=s.length,a=new Array(i);r<i;r++)a[r]=s[r].fn;return a},s.prototype.emit=function(t,e,n,s,r,i){var a=o?o+t:t;if(!this._events[a])return!1;var c,u,h=this._events[a],f=arguments.length;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),f){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,n),!0;case 4:return h.fn.call(h.context,e,n,s),!0;case 5:return h.fn.call(h.context,e,n,s,r),!0;case 6:return h.fn.call(h.context,e,n,s,r,i),!0}for(u=1,c=new Array(f-1);u<f;u++)c[u-1]=arguments[u];h.fn.apply(h.context,c)}else{var l,v=h.length;for(u=0;u<v;u++)switch(h[u].once&&this.removeListener(t,h[u].fn,void 0,!0),f){case 1:h[u].fn.call(h[u].context);break;case 2:h[u].fn.call(h[u].context,e);break;case 3:h[u].fn.call(h[u].context,e,n);break;case 4:h[u].fn.call(h[u].context,e,n,s);break;default:if(!c)for(l=1,c=new Array(f-1);l<f;l++)c[l-1]=arguments[l];h[u].fn.apply(h[u].context,c)}}return!0},s.prototype.on=function(t,e,s){var r=new n(e,s||this),i=o?o+t:t;return this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],r]:this._events[i].push(r):(this._events[i]=r,this._eventsCount++),this},s.prototype.once=function(t,e,s){var r=new n(e,s||this,!0),i=o?o+t:t;return this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],r]:this._events[i].push(r):(this._events[i]=r,this._eventsCount++),this},s.prototype.removeListener=function(t,n,s,r){var i=o?o+t:t;if(!this._events[i])return this;if(!n)return 0==--this._eventsCount?this._events=new e:delete this._events[i],this;var a=this._events[i];if(a.fn)a.fn!==n||r&&!a.once||s&&a.context!==s||(0==--this._eventsCount?this._events=new e:delete this._events[i]);else{for(var c=0,u=[],h=a.length;c<h;c++)(a[c].fn!==n||r&&!a[c].once||s&&a[c].context!==s)&&u.push(a[c]);u.length?this._events[i]=1===u.length?u[0]:u:0==--this._eventsCount?this._events=new e:delete this._events[i]}return this},s.prototype.removeAllListeners=function(t){var n;return t?(n=o?o+t:t,this._events[n]&&(0==--this._eventsCount?this._events=new e:delete this._events[n])):(this._events=new e,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prototype.setMaxListeners=function(){return this},s.prefixed=o,s.EventEmitter=s,t.exports=s}),n=Object.prototype.hasOwnProperty,s=Object.prototype.toString,r=function(t,e,r){if("[object Function]"!==s.call(e))throw new TypeError("iterator must be a function");var o=t.length;if(o===+o)for(var i=0;i<o;i++)e.call(r,t[i],i,t);else for(var a in t)n.call(t,a)&&e.call(r,t[a],a,t)},o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},c=function(){function n(s){var i=this,a=s.modules;o(this,n),this.bus=new e;var c=this.bus;this.state={},this.actions={},this.getters={},r(a,function(e,n){t("[load module] - "+n),i.state[n]=e.state,r(e.getters||{},function(t,e){i.getters[e]=function(){return t(i.state[n],i.getters)}}),r(e.actions||{},function(t,e){i.actions[e]=function(){for(var e=arguments.length,s=Array(e),r=0;r<e;r++)s[r]=arguments[r];return t.apply(void 0,[{state:i.state[n],rootState:i.state,commit:i.commit.bind(i),dispatch:i.dispatch.bind(i),getters:i.getters}].concat(s))}}),r(e.mutations||{},function(e,s){t("[load mutation] - "+s+" on "+n),c.addListener("mutation:"+s,function(t){try{i.state[n]=e(i.state[n],t),c.emit("change")}catch(t){console.error(t)}})})})}return i(n,[{key:"dispatch",value:function(t,e){return this.actions[t](e)}},{key:"commit",value:function(e,n){t("[commit] - "+e+" with "+JSON.stringify(n)),this.bus.emit("mutation:"+e,n)}},{key:"connect",value:function(t){function e(){var t=this;this.__tinax_connection__=this.__tinax_connection__||new u({bus:r}),this.__tinax_connection__.addListener("change",function(){try{t.setData(i({context:t}))}catch(t){console.error(t)}}),this.setData(i({context:this}))}function n(){this.__tinax_connection__&&this.__tinax_connection__.removeAllListeners()}var s=this,r=this.bus,o={},i=function(e){var n=e.context;return a({},t.state?t.state.call(n,s.state):{},t.getters?t.getters.call(n,s.getters):{})};return t.actions&&(o=t.actions(this.actions)),{methods:o,onLoad:e,onUnload:n,attached:e,detached:n}}}]),n}();c.debug=!1;var u=function(){function t(e){var n=e.bus;o(this,t),this.bus=n,this.handlers={}}return i(t,[{key:"addListener",value:function(t,e){return this.handlers[t]=this.handlers[t]||[],this.handlers[t].push(e),this.bus.addListener(t,e),e}},{key:"removeAllListeners",value:function(t){for(var e in this.handlers)for(var n=void 0;n=this.handlers[e].pop();)this.bus.removeListener(e,n)}}]),t}();return c});